---
layout: post
title:  "데이터 중심 애플리케이션 설계 01장"
date:   2022-02-25
comments: true
project: true
excerpt: "데이터 중심 애플리케이션 설계 01장"
categories: book
---

## 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션

오늘날 많은 애플리케이션은 계산중심과는 다르게 데이터 중심적이다.

많은 애플리 케이셔이 필요하는 데이터 요소

- database : 구동 애플리케이션이나 다른 애플리케이션에서 나중에 다른 데이터를 잧을 수 있게 데이터를 저장
- cache : 읽기 속도 향상을 위해 값비싼 수행 결과를 기억
- search index : 사용자가 키워드로 데이터를 검색하거나 다양한 방법으로 필터링할 수 있게 제공
- stream process : 비동기 처리를 위해 다른 프로세스로 메시지 보내기 
- patch processing : 주기적으로 대량의 누적된 데이터를 분석

## 데이터 시스템에 대한 생각

데이터 저장과 처리를 위한 여러 새로운 도구들이 최근에 만들어 졌고 전통적인 분류에 들어맞지 않는다.

많은 애플리케이션이 단일 도구로는 더 이상 데이터 처리와 저장 모두를 만족시킬 수 없는 과도하고 광범위한 요구사항을 갖고 있다.

데이터 시스템 설계 시 관심사 세 가지

- 신뢰성 : 하드웨어나 소프트웨어 결함, 심지어 인적 오류 같은 역경에 직면하더라도 시스템은 지속적으로 올바르게 동작해야 한다.

- 확장성 : 시스템의 데이터 양, 트래픽 양, 복잡도가 증가하면서 이를 처리할 수 있는 적절한 방법이 있어야 한다.

- 유지보수성 : 시간이 지남에 따라 여러 다양한 사람들이 시스템 상에서 작업할 것이기 때문에 모든 사용자가 시스템 상에서 생산적으로 작업할 수 있게 해야 한다.

### 신뢰성

소프트웨어의 경우 일반적으로 신뢰성에 대한 기대치는

- 애플리케이션은 사용자가 기대한 기능을 수행한다.
- 시스템은 사용자가 범한 실수나 예상치 못한 소프트웨어 사용법을 허용할 수 있다.
- 시스템 성능은 예상된 부하와 데이터 양에서 필수적인 사용 사례를 충분히 만족한다.
- 시스템은 허가되지 않은 접근과 오남용을 방지한다.

결함(fault): 잘못될 수 있는 일
내결함성 (fault-tolerant) 또는 탄력성(resilient) : 결함을 예측하고 대처할 수 있는 시스템

결함은 장애가 아니다

장애는 사용자에게 필요한 서비스를 제공하지 못하고 시스템 전체가 멈춘 경우

결함은 사양에서 벗어난 시스템의 한 구성 요소

결함 확률을 0으로 줄이는 것은 불가능하다

고의적으로 결함을 유도함으로써 내결함성 시스템을 증진시킬 수 있다. ex.) Chaos Monkey

해결책이 있는 결함의 종류

- 하드웨어 결함 : 주로 각 하드웨어 구성요소에 중복(redundancy)를 추가하는 방법으로 해결. 하드웨어 결함은 보통 독립적이여 다른 장비에 장애가 발생할 여지가 작다.
- 소프트웨어 오류 : 소프트웨어의 체계적 오류(systematic error)에는 신속한 해결책이 없다. 시스템의 가정과 상호작용에 대해 주의깊게 생각하기, 빈틈없는 테스트, 프로세스 격리(process isolation), 죽은 프로세스의 재시작 허용, 프로덕션환경에서 시스템 동작의 측정, 모니터링, 분석하기와 같은 여러 작은 일들이 문제 해결에 도움을 줄 수 있다.
- 인적 오류 : 사람은 미덥지 못하다. 다음과 같은 일들이 도움을 줄 수 있다.
  - 오류의 가능성을 최소화하는 방향으로 시스템을 설계
  - 사람이 가장 많이 실수하는 부분에서 사람의 실수로 장애가 발생할 수 있는 부분을 분리 sandbox
  - 단위 테스트부터 전체 시스템 통합테스트 수동 테스트를 통해 방지
  - 인적 오류를 빠르고 쉽게 복구할 수 있도록 하여 장애 발생 영향을 최소화
  - 성능 지표와 오류율 같은 상세하고 명확한 모니터링 대책 마련
  - 조작 교육과 실습을 시행

### 확장성

시스템이 현재 안정적으로 동작한다고 해서 미래에도 안적정으로 동작한다는 보장은 없다.

확장성을 논한다는 것은
- 시스템이 특정 방식으로 커지면 이에 대처하기 위한 선택은 무엇인가
- 추가 부하를 다루기 위해 계산 자원을 어떻게 투입할까
에 대한 질문을 고려한다는 것

#### 부하 기술하기

부하 매개변수(load parameter) : 시스템 설계에 따라 다르며 웹 서버의 초당 요청수, 데이터베이스의 읽기 대 쓰기 비율 등등이 될 수 있다.

#### 성능 기술하기

- 부하 매개변수를 증가시키고 시스템 자원(CPU, 메모리, 네트워크 대역폭 등)은 변경하지 않고 유지하면 시스템 성능은 어떻게 영향을 받을까?
- 부하 매개변수를 증가시켰을 때 성능이 변하지 않고 유지되길 원한다면 자원을 얼마나 많이 늘려야 할까?

이를 위해선 성능 수치가 필요하다. ex.) 하둡=> 처리량, 온라인 시스템 => 응답 시간
성능 수치 예를 들어 응답 시간 같은 경우 분포를 통해서 성능을 기술 하는데, 평균 지표보다는 백분위나 중앙값등을 사용하는 것이 더 현실적인 지표이다.

#### 부하 대응 접근 방식

scaling up(vertical scaling) : 좀 더 강력한 장비로 이동
scaling out(horizontal scaling) : 다수의 낮은 사양 장비에 부하를 분산

elastic : 부하 증가를 감지하면 컴퓨터 자원을 자동으로 추가

범용적이고 모든 상황에 맞는 아키텍쳐는 없다. 읽기 쓰기의 양, 저장할 데이터의 양, 데이터의 복잡도, 응답 시간 요구사항, 접근 패턴 등을 고려하자.
주요 동작이 무엇이고 잘 하지 않는 동작이 무엇인지를 잘 가정하여 아키텍쳐를 설계, 스타트업 초기 단계나 검증되지 않은 제품의 경우에 미래를 가정한 부하에 대비해 확장하기보다는 빠르게 반복하여 제품 기능을 개선하는 작업이 좀더 중요하다.

### 유지보수성

유지보수 : 버그 수정, 시스템 운영 유지, 장애 조사, 새로운 플랫폼 적응 ,새 사용 사례를 위한 변경, 기술 채무 상환, 새로운 기능 추가 등이 있다.

레거시 소프트 웨어를 직접 만들지 않게끔 소프트웨어 시스템 설계 원칙을 지키자

- 운용성 (operability) : 운영팀이 시스템을 원할하게 운영할 수 있게 쉽게 만들어라
- 단순성 (simplicity) : 시스템에서 복잡도를 최대한 제거해 새로운 엔지니어가 시스템을 이해하기 쉽게 만들어라 (사용자 인터페이스의 단순성과는 다르다는 점에 유의하라).
- 발전성 (evolvability) : 엔지니어가 이후에 시스템을 쉽게 변경할 수 있게 하라. 그래야 요구사항 변경 같은 예기치 않은 사용 사례를 적용하기가 쉽다.

#### 운용성

운영팀이 해야할 일
- 시스템 상태를 모니터링하고 상태가 좋지 않다면 빠르게 서비스를 복원
- 시스템 장애, 성능 저하 등의 문제의 원인을 추적
- 보안 패치를 포함해 소프트웨어와 플랫폼을 최신 상태로 유지
- 다른 시스템이 서로 어떻게 영향을 주는지 확인해 문제가 생길 수 있는 변경 사항을 손상을 입히기 전에 차단
- 미래에 발생 가능한 문제를 예측해 문제가 발생하기 전에 해결 (ex. 용량 계획)
- 배포,설정 관리 등을 위한 모범 사례와 도구를 마련
- 애플리케이션을 특정 플랫폼에서 다른 플랫폼으로 이동하는 등 복잡한 유지보수 태스크를 수행
- 설정 변경으로 생기는 시스템 보안 유지보수
- 예측가능한 운영과 안정적인 서비스 환경을 유지하기 위한 절차 정의
- 개인 인사 이동에도 시스템에 대한 조직의 지식을 보존함

좋은 운영성 => 동일하게 반복되는 태스크를 줄여 다른 일에 집중할 수 있도록 하는 것

이를 위해 데이터 시스템이 할 수 있는 일들
- 좋은 모니터링으로 런타임 동작과 시스템의 내부에 대한 가시성 제공
- 표준 도구를 이용해 자동화와 통합을 위한 우수한 지원을 제공
- 개발 장비 의존성을 회피, 유지보수를 위해 장비를 내리더라도 시스템 전체에 영향을 주지 않고 계속해서 운영 가능해야 함
- 좋은 문서와 이해하기 쉬운 운영 모델 제공
- 만족할 만한 기본 동작을 제공하고, 필요할 때 기본값을 다시 정의할 수 있는 자유를 관리자에게 부여
- 적절하게 자기회복이 가능할 뿐 아니라 필요에 따라 관리자가 시스템 상태를 수동으로 제어할 수 있게 함
- 예측 가능하게 동작하고 예기치 않은 상황을 최소화함

#### 단순성

복잡도는 다양한 증상으로 나타난다.

- 상태 공간의 급증
- 모듈 간 강한 커플링
- 복잡한 의존성
- 일관성 없는 명명과 용어
- 성능 문제 해결을 목표로 한 해킹
- 임시방편으로 문제를 해결한 특수 사례

우발적 복잡도 (accident complexity) : 소프트웨어가 풀어야 할 문제에 내재하고 있지 않고 구현에서만 발생하는 것

우발적 복잡도를 제거하기 위한 최상의 도구는 추상화

#### 발전성

애자일(agile) 작업 패턴은 변화에 적응하기 위한 프레임워크를 제공한다
애자일 커뮤니티는 테스트 주도 개발과 리펙토링과 같이 자주 변화하는 환경에서 소프트웨어를 개발 할 때 도움이 되는 기술 도구와 패턴을 개발하고 있다.
데이터 시스템 변경을 쉽게 하고 변화된 요구사항에 시스템을 맞추는 방법은 시스템의 간단함과 추상화와 밀접한 관련이 있다.

